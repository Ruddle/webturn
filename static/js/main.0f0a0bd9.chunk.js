(this.webpackJsonpfront=this.webpackJsonpfront||[]).push([[0],{16:function(e,t,n){var r,c=n(36).wrap,i=n(29);e.exports=function e(){return this instanceof e?c(i()):r||(r=c(i()))}},26:function(e,t,n){},28:function(e,t,n){},29:function(e,t,n){e.exports=function(){return new Worker(n.p+"5b8fc81dd777329bf501.worker.js")}},35:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),i=n(15),a=n.n(i),o=(n(26),n(3)),s=n(2),u=n(12),l=n(8),d=n.n(l),p=(n(28),n(16)),f=n.n(p),h=n(4),x=n(17);function y(e){return"function"===typeof e?e():e}function b(){for(var e=0;e<arguments.length-1;e++){var t=Object(s.a)(arguments[e],2),n=t[0],r=t[1];if(y(n))return y(r)}var c=arguments.length-1;if(!Array.isArray(arguments[c]))return y(arguments[c]);var i=Object(s.a)(arguments[c],2),a=i[0],o=i[1];return y(a)?y(o):void 0}var j=function(e,t,n){return function(e,t,n){return Math.max(t,Math.min(n,e))}((n-e)/(t-e),0,1)},v=function(e,t,n){return(r=j(e,t,n))<.5?2*r*r:(4-2*r)*r-1;var r};var m=n(18),O=(n(11),10),g={arrow:{name:"arrow",damage:1,cooldown:2,cost:4,maxDist:7},fire:{name:"fire",damage:1,radius:1.5,cooldown:4,cost:5,maxDist:7}};function E(e){return 0===e?[{u:0,v:0}]:1===e?[{u:0,v:0},{u:1,v:0},{u:0,v:1},{u:-1,v:0},{u:0,v:-1}]:1.5===e?[{u:0,v:0},{u:1,v:0},{u:0,v:1},{u:-1,v:0},{u:0,v:-1},{u:1,v:1},{u:1,v:-1},{u:-1,v:-1},{u:-1,v:1}]:2===e?[{u:0,v:0},{u:1,v:0},{u:0,v:1},{u:-1,v:0},{u:0,v:-1},{u:1,v:1},{u:1,v:-1},{u:-1,v:-1},{u:-1,v:1},{u:2,v:0},{u:0,v:2},{u:-2,v:0},{u:0,v:-2}]:2.5===e?[{u:0,v:0},{u:1,v:0},{u:0,v:1},{u:-1,v:0},{u:0,v:-1},{u:1,v:1},{u:1,v:-1},{u:-1,v:-1},{u:-1,v:1},{u:2,v:0},{u:0,v:2},{u:-2,v:0},{u:0,v:-2},{u:2,v:1},{u:1,v:2},{u:-2,v:1},{u:1,v:-2},{u:2,v:-1},{u:-1,v:2},{u:-2,v:-1},{u:-1,v:-2}]:void 0}function w(e,t){var n={x:t.x-e.x,y:t.y-e.y};return n.l=Math.sqrt(n.x*n.x+n.y*n.y),n}function I(e,t){return e.x+e.y*t.w}function _(e,t){return t.tiles[e.x+e.y*t.w]}function A(e){var t=[],n=e.currentChar;[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach((function(e){var r,c,i=Object(s.a)(e,2),a=i[0],u=i[1],l={x:(c={x:a,y:u}).x+(r=n).x,y:c.y+r.y};t.push(Object(o.a)({type:"move"},l))})),e.chars.forEach((function(e){e.team!==n.team&&t.push({type:"attack",target:e.id})})),e.chars.forEach((function(e){e.team!==n.team&&t.push({type:"arrow",target:e.id})})),t.push({type:"pass"});var r=[];return t.forEach((function(t){var n=T(e,t),c=n.cost,i=n.possible,a=n.effects;i&&r.push(Object(o.a)(Object(o.a)({},t),{},{cost:c,effects:a}))})),r}var k={END_WHOLE_TURN:"END_WHOLE_TURN",BEGIN_TURN:"BEGIN_TURN",REACT_TO_TILE:"REACT_TO_TILE",END_TURN:"END_TURN",REGEN_PA:"REGEN_PA",LOSE_PA:"LOSE_PA",LOSE_HP:"LOSE_HP",MOVE:"MOVE",EMPTY_POWER:"EMPTY_POWER",SET_FIRE:"SET_FIRE",ANIM_MOVE:"ANIM_MOVE",ANIM_ATTACK:"ANIM_ATTACK",ANIM_ARROW:"ANIM_ARROW",ANIM_END_TURN:"ANIM_END_TURN"};function T(e,t){var n=e.currentChar,r=e.currentChar.id,c=0,i=!1,a=[];if("move"===t.type){if(function(e){return 0===e.type}(_(t,e.map))){var o=w(n,t);if(o.l>0&&o.l<1.5)if((c=1===o.l?2:3)<=n.pa)(i=0===e.chars.filter((function(e){return e.x===t.x&&e.y===t.y})).length)&&(a.push({type:k.LOSE_PA,charId:r,cost:c}),a.push({type:k.ANIM_MOVE,charId:r,from:{x:n.x,y:n.y},to:{x:t.x,y:t.y}}),a.push({type:k.MOVE,charId:r,x:t.x,y:t.y}))}}else if("attack"===t.type){c=3;var s=e.chars.find((function(e){return e.id===t.target}));if(s.hp>0){var u=w(n,s);if(u.l>0&&u.l<1.5)c<=n.pa&&(i=!0,a.push({type:k.ANIM_ATTACK,charId:r,d:u}),a.push({type:k.LOSE_PA,charId:r,cost:c}),a.push({type:k.LOSE_HP,charId:t.target,hpLost:1}))}}else if("arrow"===t.type){var l=g[t.type];c=l.cost;var d=e.chars.find((function(e){return e.id===t.target}));if(!n.cooldown[t.type]&&d.hp>0){var p=w(n,d);if(p.l>0&&p.l<=l.maxDist)c<=n.pa&&(i=!0,a.push({type:k.EMPTY_POWER,charId:r,power:l.name}),a.push({type:k.ANIM_ARROW,charId:r,from:{x:n.x,y:n.y},to:{x:d.x,y:d.y},d:p}),a.push({type:k.LOSE_PA,charId:r,cost:c}),a.push({type:k.LOSE_HP,charId:t.target,hpLost:1}))}}else if("fire"===t.type){var f=g[t.type];if(c=f.cost,!n.cooldown[t.type]){var h=w(n,t);if(h.l>0&&h.l<=f.maxDist)if(c<=n.pa)i=!0,function(e,t,n){var r=[];return E(t).forEach((function(t){var c=t.u,i=t.v,a=e.x+c,o=e.y+i;if(a>=0&&a<n.w&&o>=0&&o<n.h){var s=a+o*n.w;r.push(s)}})),r}(t,f.radius,e.map).forEach((function(e){a.push({type:k.SET_FIRE,tileIndex:e})})),a.push({type:k.EMPTY_POWER,charId:r,power:f.name}),a.push({type:k.ANIM_ARROW,charId:r,from:{x:n.x,y:n.y},to:{x:t.x,y:t.y},d:h}),a.push({type:k.LOSE_PA,charId:r,cost:c}),e.chars.forEach((function(e){w(e,t).l<=f.radius&&a.push({type:k.LOSE_HP,charId:e.id,hpLost:1})}))}}else"pass"===t.type&&(c=0,i=!0,a.push({type:k.ANIM_END_TURN,charId:r}),a.push({type:k.END_TURN,charId:r}));return{cost:c,possible:i,effects:a}}function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==t.length){var r=[];t.forEach((function(t){if(t.type===k.LOSE_HP){var c=e.chars.find((function(e){return e.id===t.charId})),i=c.hp>0;c.hp=Math.max(0,c.hp-t.hpLost),i&&c.hp<=0&&e.currentChar.id===c.id&&r.push({type:k.END_TURN,charId:t.charId})}else if(t.type===k.LOSE_PA)e.chars.find((function(e){return e.id===t.charId})).pa-=t.cost;else if(t.type===k.EMPTY_POWER)e.chars.find((function(e){return e.id===t.charId})).cooldown[t.power]=g[t.power].cooldown;else if(t.type===k.MOVE){var a=e.chars.find((function(e){return e.id===t.charId}));a.x=t.x,a.y=t.y,_(t,e.map).effects.length>0&&r.push({type:k.REACT_TO_TILE,charId:a.id,tileId:I(a,e.map)})}else if(t.type===k.REGEN_PA){var s=e.chars.find((function(e){return e.id===t.charId}));s.pa=Math.min(s.pa+10,15)}else if(t.type===k.REACT_TO_TILE){var u=e.chars.find((function(e){return e.id===t.charId}));e.map.tiles[t.tileId].effects.forEach((function(e){"fire"===e.type&&r.push({type:k.LOSE_HP,charId:u.id,hpLost:1})}))}else if(t.type===k.END_TURN){var l=e.chars.find((function(e){return e.id===t.charId}));Object.keys(l.cooldown).forEach((function(e){1===l.cooldown[e]?delete l.cooldown[e]:l.cooldown[e]-=1})),l.lastPlayedTurn+=1,l.hp>0&&r.push({type:k.REGEN_PA,charId:t.charId}),"/"===e.nextChars[1]&&r.push({type:k.END_WHOLE_TURN}),e.nextChars=C(e),e.currentChar=e.nextChars[0],r.push({type:k.BEGIN_TURN})}else if(t.type===k.END_WHOLE_TURN)e.map.tiles.forEach((function(e){e.effects=e.effects.map((function(e){return Number.isInteger(e.cooldown)&&(e.cooldown-=1),e})).filter((function(e){return 0!==e.cooldown}))}));else if(t.type===k.BEGIN_TURN)r.push({type:k.REACT_TO_TILE,charId:e.currentChar.id,tileId:I(e.currentChar,e.map)});else if(t.type===k.SET_FIRE){var d=e.map.tiles[t.tileIndex],p=d.effects.find((function(e){return"fire"===e.type}));p||(p={type:"fire"},d.effects.push(p)),p.cooldown=2}!0===n&&[k.ANIM_ATTACK,k.ANIM_MOVE,k.ANIM_ARROW,k.ANIM_END_TURN].includes(t.type)&&(e.chars.find((function(e){return e.id===t.charId})).anim=Object(o.a)(Object(o.a)({},t),{},{startTime:performance.now()})),e.effects.push(Object(o.a)({computedAt:performance.now()},t))})),N(e,r,n)}}function M(e){return 0===e.type?"ground":1===e.type?"wall":"unknown"}var R,C=function(e){var t=[],n=Number.MAX_SAFE_INTEGER,r=e.chars.filter((function(e){return e.hp>0}));for(r.forEach((function(e){n=Math.min(n,e.lastPlayedTurn)})),r.filter((function(e){return e.lastPlayedTurn===n})).forEach((function(e){t.push(e)})),t.push("/");t.length<10;)r.forEach((function(e){t.push(e)}));return t.slice(0,10)},S=n(0),P=n(11),L=50,D=m.a.div(R||(R=Object(x.a)(["\n  width: 50px;\n  height: 50px;\n  transition: 200ms;\n  cursor: pointer;\n  &:hover {\n    opacity: 0.8;\n  }\n"])));function W(e){var t=e.state,n=e.user,c=e.do_action,i=Object(r.useState)(null),a=Object(s.a)(i,2),u=a[0],l=a[1],d=Object(r.useState)(null),p=Object(s.a)(d,2),f=p[0],x=p[1],y=Object(r.useMemo)((function(){return P.throttle(x,30)}),[]),j=Object(r.useMemo)((function(){var e=t.actions.map((function(e){return Object(o.a)({isAction:!0},e)})).concat(t.effects);return e.sort((function(e,t){return e.computedAt-t.computedAt})),e.splice(0,e.length-100),e}),[t]),v=t.currentChar,m=v.user===n,O=Object(r.useCallback)((function(){m&&c({type:"pass",charId:t.currentChar.id,user:n})}),[t,n,c]),w=Object(r.useState)(null),I=Object(s.a)(w,2),_=I[0],k=I[1],N=Object(r.useState)({possible:!1,cost:0,type:"none"}),M=Object(s.a)(N,2),R=M[0],C=M[1],W=Object(r.useRef)();Object(r.useEffect)((function(){var e=W.current;e.scrollTop=e.scrollHeight}),[t]),Object(r.useEffect)((function(){k(null)}),[t]);var H=Object(r.useMemo)((function(){return A(t).map((function(e){return delete e.effects,e}))}),[t]);Object(r.useEffect)((function(){m&&1===H.length&&O()}),[m,H,O]);var U=Object(r.useState)(0),G=Object(s.a)(U,2),B=G[0],Y=G[1],K=Object(r.useRef)({handle:null,tickAfter:!1});Object(r.useEffect)((function(){if(K.current.handle)K.current.tickAfter=!0;else{K.current.handle=setTimeout((function(){K.current.handle=null,K.current.tickAfter&&(Y((function(e){return e+1})),K.current.tickAfter=!1)}),100);var e="none",n=0,r=!1,c=null,i=null;null===_&&null!==f&&null===u?i={type:e="move",x:f.x,y:f.y}:"attack"!==_&&null!==_||null===u||u===t.currentChar.id?"arrow"===_&&null!==u&&u!==t.currentChar.id?i={type:e="arrow",target:u}:"fire"===_&&null!==f&&(i={type:e="fire",x:f.x,y:f.y}):i={type:e="attack",target:u},i&&(c=T(t,i)),c&&(n=c.cost,r=c.possible),C({type:e,possible:r,cost:n,rawAction:i})}}),[t,_,u,f,B]);var J=Object(r.useCallback)((function(){m&&!0===R.possible&&c(R.rawAction)}),[c,R]),q=Object(r.useCallback)((function(){m&&!0===R.possible&&c(R.rawAction)}),[c,R]),X=Object(r.useRef)();return Object(S.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[Object(S.jsx)("div",{children:"webturn v:0.0.8"}),Object(S.jsx)("div",{style:{display:"flex",alignItems:"center",padding:"10px",boxSizing:"border-box"},children:t.nextChars.map((function(e,t){return b(["/"===e,function(){return Object(S.jsx)("div",{children:"|"})}],(function(){return Object(S.jsxs)("div",{onMouseEnter:function(){return l(e.id)},onMouseLeave:function(){return l(null)},style:{background:u===e.id?"#ccc":"#fff",padding:"5px",margin:"5px",color:"black",userSelect:"none",border:0===t?"4px solid #aef":"2px solid #0000",borderRadius:"5px"},children:[Object(S.jsx)("div",{children:Object(S.jsx)("img",{style:{width:"30px"},src:e.avatar})}),e.name]},e.id+t)}))}))}),Object(S.jsxs)("div",{style:{display:"flex"},children:[Object(S.jsxs)("div",{style:{position:"relative",cursor:b([!m,"not-allowed"],["attack"===R.type,"crosshair"],[!0===R.possible,"pointer"],"not-allowed")},children:[P.chunk(t.map.tiles,t.map.w).map((function(e,n){return Object(S.jsx)("div",{style:{display:"flex"},children:e.map((function(e,r){return Object(S.jsx)("div",{style:{width:"50px",height:"50px",position:"relative",transition:"50ms",background:b([1===e.type,"#333"],[0===e.type&&(null===f||void 0===f?void 0:f.index)===r+t.map.w*n,"#bbb"],"#999")},children:e.effects.map((function(e){return Object(S.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"30px",height:"30px",background:"#f609"}})}))},r)}))},n)})),Object(S.jsx)("div",{onClick:function(){return J(f.x,f.y)},ref:X,onMouseMove:function(e){var n=X.current.getBoundingClientRect(),r=Math.floor((e.clientX-n.x)/L),c=Math.floor((e.clientY-n.y)/L),i=r+t.map.w*c;y({x:r,y:c,index:i})},style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"}}),Object(S.jsx)("div",{style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",pointerEvents:"none"},children:f&&R&&g[R.type]&&void 0!==g[R.type].radius&&E(g[R.type].radius).map((function(e){var t=e.u,n=e.v;return Object(S.jsx)("div",{style:{position:"absolute",left:L*(t+f.x)+"px",top:L*(n+f.y)+"px",width:"50px",height:"50px",background:"#fff5"}},t+"/"+n)}))}),t.chars.map((function(e){return Object(S.jsx)(z,{charHover:u,onMouseEnter:function(){return l(e.id)},onMouseLeave:function(){return l(null)},onClick:function(){return q(e.id)},currentChar:v,char:e},"cahr"+e.id)}))]}),Object(S.jsx)(V,{tileHover:f,charHover:u,state:t})]}),Object(S.jsxs)("div",{style:{opacity:m?"1":"0.7",cursor:m?"auto":"not-allowed"},children:[Object(S.jsx)("div",{style:{display:"flex",alignItems:"center",margin:"10px"},children:b(["none"===R.type,function(){return Object(S.jsx)("div",{children:"none"})}],["none"!==R.type,function(){return Object(S.jsxs)("div",{style:{color:R.possible?"black":"red"},children:[R.type," (cost ",R.cost,")"]})}])}),Object(S.jsx)("div",{style:{display:"flex",alignItems:"center",margin:"10px"},children:Object(h.a)(Array(15).keys()).map((function(e){return Object(S.jsx)("div",{style:{width:"30px",height:"30px",borderRadius:"50%",margin:"5px",border:"3px solid black",transition:"500ms",background:b([e+1<=v.pa-R.cost,"#bbb"],[e+1<=v.pa,"#5ee"],"#000")}},v.id+"/"+e)}))}),Object(S.jsxs)("div",{style:{margin:"10px",background:"#eee"},children:[Object(S.jsx)("div",{style:{fontSize:"1.2em",background:"#345",color:"white",padding:"5px"},children:"Power"}),Object(S.jsxs)("div",{style:{display:"flex"},children:[Object(S.jsx)(D,{onClick:function(){return k(null)},style:{display:"flex",alignItems:"center",justifyContent:"center",background:"#333",color:"white",border:"3px solid #000"},children:"Move"}),Object(S.jsx)(D,{onClick:O,style:{display:"flex",alignItems:"center",justifyContent:"center",background:"#333",color:"white",border:"3px solid #000"},children:"Pass"}),Object(S.jsx)(D,{onClick:function(){return k((function(e){return"attack"===e?null:"attack"}))},style:{display:"flex",alignItems:"center",justifyContent:"center",background:"attack"===_?"#999":"#333",color:"white",border:"3px solid #000"},children:"Attack"}),["arrow","fire"].map((function(e){return Object(S.jsxs)(D,{onClick:function(){v.cooldown[e]||k((function(t){return t===e?null:e}))},style:{display:"flex",alignItems:"center",justifyContent:"center",background:b([v.cooldown[e],"#a00"],_===e?"#999":"#333"),color:"white",border:"3px solid #000"},children:[e,v.cooldown[e]&&" ("+v.cooldown[e]+")"]},e)}))]})]}),Object(S.jsxs)("div",{style:{display:"flex",flexDirection:"row",margin:"10px"},children:[Object(S.jsxs)("div",{style:{marginRight:"20px",minWidth:"450px"},children:[Object(S.jsx)("div",{style:{fontSize:"1.2em",background:"#345",color:"white",padding:"5px"},children:"History"}),Object(S.jsx)("div",{ref:W,style:{background:"#eee",height:"200px",overflowY:"scroll",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"},children:j.map((function(e,n){return Object(S.jsx)("div",{style:{},children:Object(S.jsx)(F,{action:e,state:t})},n)}))})]}),Object(S.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",flex:"1 100 auto",background:"#eee",minWidth:"450px"},children:[Object(S.jsx)("div",{style:{fontSize:"1.2em",background:"#345",color:"white",padding:"5px",width:"100%",boxSizing:"border-box"},children:"Possible actions"}),H.map((function(e,t){return Object(S.jsx)("div",{children:JSON.stringify(e)},t)}))]})]})]})]})}function H(e){var t=e.name,n=e.avatar;return Object(S.jsxs)("div",{style:{fontWeight:"500",width:"100px",flex:"none",display:"flex",alignItems:"center",background:"#ccc",color:"black",height:"30px"},children:[Object(S.jsx)("img",{style:{width:"30px",marginRight:"5px"},src:n}),Object(S.jsx)("div",{children:t})]})}function U(e){var t=e.effect,n=e.state,c=Object(r.useMemo)((function(){return n.chars.find((function(e){return e.id===t.charId}))}),[n]),i=Object(r.useMemo)((function(){var e=P.cloneDeep(t);return delete e.computedAt,delete e.charId,delete e.type,e}),[t]);return Object(S.jsxs)("div",{style:{margin:"2px",display:"flex",alignItems:"center",justifyContent:"flex-start"},children:[Object(S.jsx)("div",{style:{marginRight:"40px"}}),c&&Object(S.jsx)(H,{name:c.name,avatar:c.avatar}),Object(S.jsx)("div",{style:{fontWeight:"500",width:"150px",padding:"4px",height:"30px",boxSizing:"border-box",flex:"none",display:"flex",alignItems:"center",justifyContent:"flex-start",background:"#666",color:"white"},children:t.type}),Object(S.jsx)("div",{style:{fontSize:"0.8em",fontWeight:"bold",padding:"2px"},children:JSON.stringify(i)})]})}function F(e){var t=e.action,n=e.state;return t.isAction?Object(S.jsxs)("div",{style:{margin:"2px",display:"flex",alignItems:"center",justifyContent:"flex-start"},children:[Object(S.jsx)(H,{name:t.char.name,avatar:t.char.avatar}),Object(S.jsx)("div",{style:{fontWeight:"500",width:"150px",padding:"4px",height:"30px",boxSizing:"border-box",flex:"none",display:"flex",alignItems:"center",justifyContent:"flex-start",background:"#666",color:"white"},children:t.type}),b(["move"===t.type,function(){return Object(S.jsxs)("div",{style:{fontSize:"0.8em",fontWeight:"bold",padding:"2px"},children:["x:",t.x," / y:",t.y]})}],["attack"===t.type||"arrow"===t.type,function(){var e=n.chars.find((function(e){return e.id===t.target}));return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(H,{name:e.name,avatar:e.avatar})," ",Object(S.jsx)("div",{style:{fontSize:"0.8em",fontWeight:"bold",padding:"2px"}})]})}],["pass"===t.type,function(){return Object(S.jsx)("div",{})}])]}):Object(S.jsx)(U,{effect:t,state:n})}function z(e){var t=e.char,n=e.charHover,i=e.currentChar,a=e.onMouseEnter,o=e.onMouseLeave,u=e.onClick,l=t.id,d=t.hp,p=t.avatar,f=Object(r.useRef)(t);Object(r.useEffect)((function(){f.current=t}),[t]);var x=Object(r.useState)({x:t.x,y:t.y}),y=Object(s.a)(x,2),j=y[0],m=y[1],g=Object(r.useState)(null),E=Object(s.a)(g,2),w=E[0],I=E[1];return function(e){var t=c.a.useRef(),n=c.a.useRef(),r=function r(c){if(void 0!==n.current){var i=c-n.current;e(i)}n.current=c,t.current=requestAnimationFrame(r)};c.a.useEffect((function(){return t.current=requestAnimationFrame(r),function(){return cancelAnimationFrame(t.current)}}),[])}((function(){var e=f.current;if(e.anim){var t=performance.now()-e.anim.startTime,n=Math.min(1,Math.max(0,t/500));if(e.anim.type===k.ANIM_MOVE)m({x:e.anim.from.x*(1-n)+e.anim.to.x*n,y:e.anim.from.y*(1-n)+e.anim.to.y*n});else if(e.anim.type===k.ANIM_ATTACK){var r=v(0,.5,n)*v(1,.5,n);m({x:e.x*(1-r)+(e.x+.5*e.anim.d.x)*r,y:e.y*(1-r)+(e.y+.5*e.anim.d.y)*r})}else if(e.anim.type===k.ANIM_ARROW){var c=v(0,.5,n)*v(1,.5,n);m({x:e.x*(1-c)+(e.x+.5*e.anim.d.x/e.anim.d.l)*c,y:e.y*(1-c)+(e.y+.5*e.anim.d.y/e.anim.d.l)*c})}else if(e.anim.type===k.ANIM_END_TURN){var i=-(30+10*v(0,1,n));I({y:i+"px",opacity:v(0,.4,n)*v(1,.7,n)}),1===n&&I(null)}1===n&&(e.anim=null)}else m(e)})),Object(S.jsxs)("div",{onMouseEnter:a,onMouseLeave:o,onClick:u,style:{position:"absolute",left:(.15+j.x)*L+"px",top:(.15+j.y)*L+"px",color:"#eee",fontWeight:500,background:n===l?"#fff":"#0000",width:"35px",height:"35px",boxShadow:i.id===l?"0px 0px 20px blue,0px 0px 5px #0009":"0px 0px 20px #0009",borderRadius:"50%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",userSelect:"none"},children:[w&&Object(S.jsx)("div",{style:{position:"absolute",left:"50%",top:"0px",transform:"translate(-50%,"+w.y+")",zIndex:"500"},children:Object(S.jsx)("div",{style:{background:"#fff9",display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"50%",opacity:w.opacity},children:Object(S.jsx)("img",{style:{width:"20px"},src:"/webturn/img/time.svg"})})},"endTurn")," ",Object(S.jsx)("img",{style:{width:"30px"},src:p}),Object(S.jsx)("div",{style:{background:"#111",padding:"2px 1px 2px 2px",display:"flex"},children:Object(h.a)(Array(O).keys()).map((function(e){return Object(S.jsx)("div",{style:{width:"4px",height:"4px",borderRadius:"1px",margin:"0px 1px 0px 0px",transition:"300ms",background:b([0===d,"#000"],[e+1<=d,"green"],"#e00")}},e)}))})]},l)}function G(e){var t=e.category,n=e.value;return Object(S.jsxs)("div",{style:{display:"flex",border:"1px solid white",margin:"5px",padding:"5px",alignItems:"center",justifyContent:"flex-start"},children:[Object(S.jsx)("div",{style:{width:"100px",flex:"none",textAlign:"left"},children:t}),Object(S.jsx)("div",{style:{width:"100px",textAlign:"left"},children:n})]})}function V(e){var t=e.tileHover,n=e.charHover,c=e.state,i=Object(r.useMemo)((function(){return c.chars.find((function(e){return e.id===n}))}),[c,n]),a=Object(r.useMemo)((function(){if(t)return c.map.tiles[t.index]}),[t,c]);return Object(S.jsx)("div",{style:{marginLeft:"50px",width:"300px",height:"500px",background:"#345",color:"#fff"},children:b([i,function(){return Object(S.jsxs)("div",{children:[Object(S.jsx)("div",{style:{margin:"10px"},children:Object(S.jsx)("img",{src:i.avatar,style:{width:"30px"}})}),Object(S.jsx)("div",{style:{margin:"10px"},children:i.name}),Object(S.jsx)(G,{category:"team",value:i.team}),Object(S.jsx)(G,{category:"user",value:i.user}),Object(S.jsx)(G,{category:"hp",value:i.hp}),Object(S.jsx)(G,{category:"pa",value:i.pa}),Object.keys(i.cooldown).length>0&&Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)("div",{children:"Cooldown"}),Object.keys(i.cooldown).map((function(e){return Object(S.jsx)(G,{category:e,value:i.cooldown[e]})}))]})]})}],[a,function(){return Object(S.jsxs)("div",{children:[" ",Object(S.jsx)(G,{category:"type",value:M(a)}),a.effects.length>0&&Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)("div",{children:"Effects"}),a.effects.map((function(e){return Object(S.jsxs)("div",{children:[Object(S.jsx)(G,{category:"type",value:e.type}),Object(S.jsx)(G,{category:"cooldown",value:e.cooldown})]})}))]})]})}],Object(S.jsx)("div",{children:"Hover something"}))})}var B=n(11),Y=new f.a,K={w:14,h:14,tiles:"\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, \n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, \n  1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, \n  1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, \n  1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,\n  1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, \n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1\n".replace(" ","").split(",").map((function(e){return{type:parseInt(e),effects:[]}}))},J=null;function q(e,t){return X.apply(this,arguments)}function X(){return(X=Object(u.a)(d.a.mark((function e(t,n){var r,c,i,a,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("dispatch start",n.type),"tick"!==n.type){e.next=9;break}if("me"!==t.currentChar.user){e.next=6;break}return e.abrupt("return",t);case 6:return e.next=8,Y.generateBestIAAction(t);case 8:n=e.sent;case 9:return r=B.cloneDeep(t),c=T(r,n,t.currentChar.user),i=c.cost,a=c.possible,s=c.effects,a&&(r.actions.push(Object(o.a)(Object(o.a)({computedAt:performance.now()},n),{},{char:r.currentChar,cost:i})),N(r,s,!0)),console.log("dispatch end"),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=function(){var e=Object(r.useRef)(function(){var e=function(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)},t=[0,e(),e(),e(),e(),e()],n={lastEffectTime:performance.now(),map:K,chars:[{id:t[0],x:1,y:1,name:"foo",lastPlayedTurn:-1,user:"me",team:"1",pa:10,avatar:"https://avatars.dicebear.com/api/bottts/"+t[0]+".svg",hp:O,cooldown:{}},{id:t[1],x:5,y:2,name:"bar",lastPlayedTurn:-1,user:"ia2",team:"2",pa:10,avatar:"https://avatars.dicebear.com/api/bottts/"+t[1]+".svg",hp:O,cooldown:{}},{id:t[2],x:5,y:5,name:"baz",lastPlayedTurn:-1,user:"ia3",team:"3",pa:10,avatar:"https://avatars.dicebear.com/api/bottts/"+t[2]+".svg",hp:O,cooldown:{}},{id:t[3],x:11,y:11,name:"zoo",lastPlayedTurn:-1,user:"ia4",team:"4",pa:10,avatar:"https://avatars.dicebear.com/api/bottts/"+t[3]+".svg",hp:O,cooldown:{}},{id:t[4],x:2,y:11,name:"moo",lastPlayedTurn:-1,user:"ia5",team:"5",pa:10,avatar:"https://avatars.dicebear.com/api/bottts/"+t[4]+".svg",hp:O,cooldown:{}}],actions:[],effects:[]};return n.nextChars=C(n),n.currentChar=n.nextChars[0],n}()),t=Object(r.useCallback)(function(){var t=Object(u.a)(d.a.mark((function t(n){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!J){t.next=4;break}if(console.error("alreadyReducing !!!",J,"while starting",n),"tick"!==n.type){t.next=4;break}return t.abrupt("return");case 4:return J=n,t.next=7,q(e.current,n);case 7:e.current=t.sent,J=null,a(e.current);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[]),n=Object(r.useState)(e.current),c=Object(s.a)(n,2),i=c[0],a=c[1];return Object(r.useEffect)((function(){setTimeout((function(){t({type:"tick"})}),500)}),[i,t]),Object(S.jsx)("div",{className:"App",children:Object(S.jsx)(W,{user:"me",state:i,do_action:t})})},Z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,i=t.getLCP,a=t.getTTFB;n(e),r(e),c(e),i(e),a(e)}))};a.a.render(Object(S.jsx)(c.a.StrictMode,{children:Object(S.jsx)(Q,{})}),document.getElementById("root")),Z()}},[[35,1,2]]]);
//# sourceMappingURL=main.0f0a0bd9.chunk.js.map