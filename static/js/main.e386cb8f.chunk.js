(this.webpackJsonpfront=this.webpackJsonpfront||[]).push([[0],{28:function(e,t,n){var r,a=n(54).wrap,c=n(55);e.exports=function e(){return this instanceof e?a(c()):r||(r=a(c()))}},52:function(e,t,n){},55:function(e,t,n){e.exports=function(){return new Worker(n.p+"2f3823dcfd96f47a2e1d.worker.js")}},56:function(e,t,n){},62:function(e,t,n){"use strict";n.r(t);var r=n(4),a=n.n(r),c=n(22),i=n.n(c),o=(n(52),n(10)),s=n(12),u=n(18),l=n(13),d=n.n(l),f=n(28),p=n.n(f),h=(n(56),n(14)),x=n(40);function j(e){return"function"===typeof e?e():e}function b(){for(var e=0;e<arguments.length-1;e++){var t=Object(s.a)(arguments[e],2),n=t[0],r=t[1];if(j(n))return j(r)}var a=arguments.length-1;if(!Array.isArray(arguments[a]))return j(arguments[a]);var c=Object(s.a)(arguments[a],2),i=c[0],o=c[1];return j(i)?j(o):void 0}var y=function(e,t,n){return function(e,t,n){return Math.max(t,Math.min(n,e))}((n-e)/(t-e),0,1)},m=function(e,t,n){return(r=y(e,t,n))<.5?2*r*r:(4-2*r)*r-1;var r};var v=n(41),O=n(69),g=n(70),w=n(67),E=n(68),I=(n(35),10),M=10,_={arrow:{name:"arrow",damage:1,cooldown:2,cost:4,maxDist:7},fire:{name:"fire",damage:1,radius:1.5,cooldown:4,cost:5,maxDist:7}};function A(e,t){var n={x:t.x-e.x,y:t.y-e.y};return n.l=Math.sqrt(n.x*n.x+n.y*n.y),n}function T(e,t){return e.x+e.y*t.w}function k(e,t){return t.tiles[e.x+e.y*t.w]}function C(e){var t=[],n=e.currentChar;[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach((function(e){var r,a,c=Object(s.a)(e,2),i=c[0],u=c[1],l={x:(a={x:i,y:u}).x+(r=n).x,y:a.y+r.y};t.push(Object(o.a)({type:"move"},l))})),e.chars.forEach((function(e){e.team!==n.team&&t.push({type:"attack",target:e.id})})),e.chars.forEach((function(e){e.team!==n.team&&t.push({type:"arrow",target:e.id})})),e.chars.forEach((function(e){e.team!==n.team&&t.push({type:"fire",x:e.x,y:e.y})})),t.push({type:"pass"});var r=[];return t.forEach((function(t){var n=R(e,t),a=n.cost,c=n.possible,i=n.effects;c&&r.push(Object(o.a)(Object(o.a)({},t),{},{cost:a,effects:i}))})),r}var N={END_WHOLE_TURN:"END_WHOLE_TURN",BEGIN_TURN:"BEGIN_TURN",REACT_TO_TILE:"REACT_TO_TILE",END_TURN:"END_TURN",REGEN_PA:"REGEN_PA",LOSE_PA:"LOSE_PA",LOSE_HP:"LOSE_HP",MOVE:"MOVE",EMPTY_POWER:"EMPTY_POWER",SET_FIRE:"SET_FIRE",ANIM_MOVE:"ANIM_MOVE",ANIM_ATTACK:"ANIM_ATTACK",ANIM_ARROW:"ANIM_ARROW",ANIM_END_TURN:"ANIM_END_TURN"};function R(e,t){var n=e.currentChar,r=e.currentChar.id,a=0,c=!1,i=[];if("move"===t.type){if(function(e){return 0===e.type}(k(t,e.map))){var o=A(n,t);if(o.l>0&&o.l<1.5)if((a=1===o.l?2:3)<=n.pa)(c=0===e.chars.filter((function(e){return e.x===t.x&&e.y===t.y})).length)&&(i.push({type:N.LOSE_PA,charId:r,cost:a}),i.push({type:N.ANIM_MOVE,charId:r,from:{x:n.x,y:n.y},to:{x:t.x,y:t.y}}),i.push({type:N.MOVE,charId:r,x:t.x,y:t.y}))}}else if("attack"===t.type){a=3;var s=e.chars.find((function(e){return e.id===t.target}));if(s.hp>0){var u=A(n,s);if(u.l>0&&u.l<1.5)a<=n.pa&&(c=!0,i.push({type:N.ANIM_ATTACK,charId:r,d:u}),i.push({type:N.LOSE_PA,charId:r,cost:a}),i.push({type:N.LOSE_HP,charId:t.target,hpLost:1}))}}else if("arrow"===t.type){var l=_[t.type];a=l.cost;var d=e.chars.find((function(e){return e.id===t.target}));if(!n.cooldown[t.type]&&d.hp>0){var f=A(n,d);if(f.l>0&&f.l<=l.maxDist)a<=n.pa&&(c=!0,i.push({type:N.EMPTY_POWER,charId:r,power:l.name}),i.push({type:N.ANIM_ARROW,charId:r,from:{x:n.x,y:n.y},to:{x:d.x,y:d.y},d:f}),i.push({type:N.LOSE_PA,charId:r,cost:a}),i.push({type:N.LOSE_HP,charId:t.target,hpLost:1}))}}else if("fire"===t.type){var p=_[t.type];if(a=p.cost,!n.cooldown[t.type]){var h=A(n,t);if(h.l<=p.maxDist)if(a<=n.pa)c=!0,function(e,t,n){var r=[],a=function(e){return 0===e?[{u:0,v:0}]:1===e?[{u:0,v:0},{u:1,v:0},{u:0,v:1},{u:-1,v:0},{u:0,v:-1}]:1.5===e?[{u:0,v:0},{u:1,v:0},{u:0,v:1},{u:-1,v:0},{u:0,v:-1},{u:1,v:1},{u:1,v:-1},{u:-1,v:-1},{u:-1,v:1}]:2===e?[{u:0,v:0},{u:1,v:0},{u:0,v:1},{u:-1,v:0},{u:0,v:-1},{u:1,v:1},{u:1,v:-1},{u:-1,v:-1},{u:-1,v:1},{u:2,v:0},{u:0,v:2},{u:-2,v:0},{u:0,v:-2}]:2.5===e?[{u:0,v:0},{u:1,v:0},{u:0,v:1},{u:-1,v:0},{u:0,v:-1},{u:1,v:1},{u:1,v:-1},{u:-1,v:-1},{u:-1,v:1},{u:2,v:0},{u:0,v:2},{u:-2,v:0},{u:0,v:-2},{u:2,v:1},{u:1,v:2},{u:-2,v:1},{u:1,v:-2},{u:2,v:-1},{u:-1,v:2},{u:-2,v:-1},{u:-1,v:-2}]:void 0}(t);return a.forEach((function(t){var a=t.u,c=t.v,i=e.x+a,o=e.y+c;if(i>=0&&i<n.w&&o>=0&&o<n.h){var s=i+o*n.w;r.push(s)}})),r}(t,p.radius,e.map).forEach((function(e){i.push({type:N.SET_FIRE,tileIndex:e})})),i.push({type:N.EMPTY_POWER,charId:r,power:p.name}),i.push({type:N.ANIM_ARROW,charId:r,from:{x:n.x,y:n.y},to:{x:t.x,y:t.y},d:h}),i.push({type:N.LOSE_PA,charId:r,cost:a}),e.chars.forEach((function(e){A(e,t).l<=p.radius&&i.push({type:N.LOSE_HP,charId:e.id,hpLost:1})}))}}else"pass"===t.type&&(a=0,c=!0,i.push({type:N.ANIM_END_TURN,charId:r}),i.push({type:N.END_TURN,charId:r}));return{cost:a,possible:c,effects:i}}function S(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==t.length){var r=[];t.forEach((function(t){if(t.type===N.LOSE_HP){var a=e.chars.find((function(e){return e.id===t.charId})),c=a.hp>0;a.hp=Math.max(0,a.hp-t.hpLost),c&&a.hp<=0&&e.currentChar.id===a.id&&(e.nextChars=D(e),e.currentChar=e.nextChars[0],r.push({type:N.END_TURN,charId:t.charId}))}else if(t.type===N.LOSE_PA)e.chars.find((function(e){return e.id===t.charId})).pa-=t.cost;else if(t.type===N.EMPTY_POWER)e.chars.find((function(e){return e.id===t.charId})).cooldown[t.power]=_[t.power].cooldown;else if(t.type===N.MOVE){var i=e.chars.find((function(e){return e.id===t.charId}));i.x=t.x,i.y=t.y,k(t,e.map).effects.length>0&&r.push({type:N.REACT_TO_TILE,charId:i.id,tileId:T(i,e.map)})}else if(t.type===N.REGEN_PA){var s=e.chars.find((function(e){return e.id===t.charId}));s.pa=Math.min(s.pa+10,15)}else if(t.type===N.REACT_TO_TILE){var u=e.chars.find((function(e){return e.id===t.charId}));e.map.tiles[t.tileId].effects.forEach((function(e){"fire"===e.type&&r.push({type:N.LOSE_HP,charId:u.id,hpLost:1})}))}else if(t.type===N.END_TURN){var l=e.chars.find((function(e){return e.id===t.charId}));Object.keys(l.cooldown).forEach((function(e){1===l.cooldown[e]?delete l.cooldown[e]:l.cooldown[e]-=1})),l.lastPlayedTurn+=1,l.hp>0&&r.push({type:N.REGEN_PA,charId:t.charId}),"/"===e.nextChars[1]&&r.push({type:N.END_WHOLE_TURN}),e.nextChars=D(e),e.currentChar=e.nextChars[0],r.push({type:N.BEGIN_TURN})}else if(t.type===N.END_WHOLE_TURN)e.map.tiles.forEach((function(e){e.effects=e.effects.map((function(e){return Number.isInteger(e.cooldown)&&(e.cooldown-=1),e})).filter((function(e){return 0!==e.cooldown}))}));else if(t.type===N.BEGIN_TURN)r.push({type:N.REACT_TO_TILE,charId:e.currentChar.id,tileId:T(e.currentChar,e.map)});else if(t.type===N.SET_FIRE){var d=e.map.tiles[t.tileIndex],f=d.effects.find((function(e){return"fire"===e.type}));f||(f={type:"fire"},d.effects.push(f)),f.cooldown=2}!0===n&&[N.ANIM_ATTACK,N.ANIM_MOVE,N.ANIM_ARROW,N.ANIM_END_TURN].includes(t.type)&&(e.chars.find((function(e){return e.id===t.charId})).anim=Object(o.a)(Object(o.a)({},t),{},{startTime:performance.now()})),e.effects.push(Object(o.a)({computedAt:performance.now()},t))})),S(e,r,n)}}function P(e){return 0===e.type?"ground":1===e.type?"wall":"unknown"}var L,D=function(e){var t=[],n=Number.MAX_SAFE_INTEGER,r=e.chars.filter((function(e){return e.hp>0}));for(r.forEach((function(e){n=Math.min(n,e.lastPlayedTurn)})),r.filter((function(e){return e.lastPlayedTurn===n})).forEach((function(e){t.push(e)})),t.push("/");t.length<10;)r.forEach((function(e){t.push(e)}));return t.slice(0,10)},z=n(8),F=n(15),H=n(5),W=new p.a,U=n(35),G=v.a.div(L||(L=Object(x.a)(["\n  width: 50px;\n  height: 50px;\n  transition: 200ms;\n  cursor: pointer;\n  &:hover {\n    opacity: 0.8;\n  }\n"])));function B(e){var t=e.state,n=e.user,a=e.do_action,c=Object(r.useState)(null),i=Object(s.a)(c,2),l=i[0],f=i[1],p=Object(r.useState)(null),x=Object(s.a)(p,2),j=x[0],y=x[1],m=Object(r.useMemo)((function(){return U.throttle(y,30)}),[]),v=Object(r.useMemo)((function(){var e=t.actions.map((function(e){return Object(o.a)({isAction:!0},e)})).concat(t.effects);return e.sort((function(e,t){return e.computedAt-t.computedAt})),e.splice(0,e.length-100),e}),[t]),w=t.currentChar,E=w.user===n,I=Object(r.useMemo)((function(){return t.chars.find((function(e){return e.user===n})).team}),[t,n]),M=Object(r.useCallback)((function(){E&&a({type:"pass",charId:t.currentChar.id,user:n})}),[t,n,a]),A=Object(r.useState)(null),T=Object(s.a)(A,2),k=T[0],N=T[1],R=Object(r.useState)({possible:!1,cost:0,type:"none"}),S=Object(s.a)(R,2),P=S[0],L=S[1],D=Object(r.useRef)();Object(r.useEffect)((function(){var e=D.current;e.scrollTop=e.scrollHeight}),[t]),Object(r.useEffect)((function(){N(null)}),[t]);var B=Object(r.useMemo)((function(){return C(t).map((function(e){return delete e.effects,e}))}),[t]);Object(r.useEffect)((function(){E&&1===B.length&&setTimeout((function(){M()}),500)}),[E,B,M]);var V=Object(r.useState)(0),Y=Object(s.a)(V,2),J=Y[0],Z=Y[1],$=Object(r.useRef)({handle:null,tickAfter:!1});Object(r.useEffect)((function(){if($.current.handle)$.current.tickAfter=!0;else{$.current.handle=setTimeout((function(){$.current.handle=null,$.current.tickAfter&&(Z((function(e){return e+1})),$.current.tickAfter=!1)}),100);var e="none",n=0,r=!1,a=null,c=null;null===k&&null!==j&&null===l?c={type:e="move",x:j.x,y:j.y}:"attack"!==k&&null!==k||null===l||l===t.currentChar.id?"arrow"===k?(e="arrow",null!==l&&l!==t.currentChar.id&&(c={type:e,target:l})):"fire"===k&&null!==j&&(c={type:e="fire",x:j.x,y:j.y}):c={type:e="attack",target:l},Object(u.a)(d.a.mark((function i(){return d.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!c){i.next=4;break}return i.next=3,W.evaluateAction(t,c);case 3:a=i.sent;case 4:a&&(n=a.cost,r=a.possible),L({type:e,possible:r,cost:n,rawAction:c});case 6:case"end":return i.stop()}}),i)})))()}}),[t,k,l,j,J]);var ee=Object(r.useCallback)((function(){E&&!0===P.possible&&a(P.rawAction)}),[a,P]),te=Object(r.useCallback)((function(){E&&!0===P.possible&&a(P.rawAction)}),[a,P]);Object(r.useRef)();return Object(H.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[Object(H.jsxs)("div",{style:{display:"flex",width:"100%",position:"relative"},children:[Object(H.jsx)("div",{onClick:ee,style:{flex:"1 1 auto",height:window.innerHeight-100+"px",position:"relative"},children:Object(H.jsxs)(F.a,{onCreated:function(e){e.gl.setClearColor(new z.Color("#789"))},camera:{position:[3,30,20],fov:35},shadows:!0,children:[Object(H.jsx)(O.a,{makeDefault:!0}),Object(H.jsxs)("group",{"position-x":-7,"position-z":-7,children:[Object(H.jsx)("ambientLight",{intensity:.5}),Object(H.jsx)("pointLight",{castShadow:!0,position:[0,5,0],"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,color:"#fdb"}),Object(H.jsx)("pointLight",{castShadow:!0,position:[14,5,14],"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,color:"#bdf"}),U.chunk(t.map.tiles,t.map.w).map((function(e,n){return e.map((function(e,r){return Object(H.jsx)(Q,{tile:e,setTileHover:m,tileHover:j,colIndex:r,rowIndex:n,state:t},r)}))})),t.chars.map((function(e){return Object(H.jsx)(q,{charHover:l,onMouseEnter:function(){return f(e.id)},onMouseLeave:function(){return f(null)},onClick:function(){return te(e.id)},currentChar:w,char:e,myTeam:I},"cahr"+e.id)})),P&&_[P.type]&&void 0!==_[P.type].maxDist&&Object(H.jsxs)("mesh",{castShadow:!0,receiveShadow:!0,position:[w.x,0,w.y],scale:1,children:[Object(H.jsx)("sphereGeometry",{args:[_[P.type].maxDist]}),Object(H.jsx)("meshBasicMaterial",{color:"green",transparent:!0,opacity:.3,blending:z.AdditiveBlending})]})]}),Object(H.jsx)(g.a,{showPanel:0,className:"stats"})]})}),Object(H.jsx)("div",{style:{position:"absolute",top:"0px",left:"90px"},children:"webturn v:0.0.10"}),Object(H.jsx)("div",{style:{position:"absolute",top:"10px",left:"50%",transform:"translate(-50%,0%)",display:"flex",alignItems:"center",padding:"5px",boxSizing:"border-box",background:"#fff5",borderRadius:"5px"},children:t.nextChars.map((function(e,t){return b(["/"===e,function(){return Object(H.jsx)("div",{children:"|"})}],(function(){return Object(H.jsxs)("div",{onMouseEnter:function(){return f(e.id)},onMouseLeave:function(){return f(null)},style:{background:l===e.id?"#ccc":"#fff",padding:"5px",margin:"5px",color:"black",userSelect:"none",border:0===t?"4px solid #aef":"2px solid #0000",borderRadius:"5px"},children:[Object(H.jsx)("div",{children:Object(H.jsx)("img",{style:{width:"30px"},src:e.avatar})}),e.name]},e.id+t)}))}))}),Object(H.jsx)(X,{tileHover:j,charHover:l,state:t}),Object(H.jsxs)("div",{style:{position:"absolute",bottom:"0px",left:"0px",opacity:E?"1":"0.7",cursor:E?"auto":"not-allowed"},children:[Object(H.jsx)("div",{style:{display:"flex",alignItems:"center",margin:"10px"},children:b(["none"===P.type,function(){return Object(H.jsx)("div",{children:"none"})}],["none"!==P.type,function(){return Object(H.jsxs)("div",{style:{color:P.possible?"black":"red"},children:[P.type," (cost ",P.cost,")"]})}])}),Object(H.jsx)("div",{style:{display:"flex",alignItems:"center",margin:"10px"},children:Object(h.a)(Array(15).keys()).map((function(e){return Object(H.jsx)("div",{style:{width:"30px",height:"30px",borderRadius:"50%",margin:"5px",border:"3px solid black",transition:"500ms",background:b([e+1<=w.pa-P.cost,"#bbb"],[e+1<=w.pa,"#5ee"],"#000")}},w.id+"/"+e)}))}),Object(H.jsxs)("div",{style:{margin:"10px",background:"#777"},children:[Object(H.jsx)("div",{style:{fontSize:"1.2em",background:"#345",color:"white",padding:"5px"},children:"Power"}),Object(H.jsxs)("div",{style:{display:"flex"},children:[Object(H.jsx)(G,{onClick:function(){return N(null)},style:{display:"flex",alignItems:"center",justifyContent:"center",background:"#333",color:"white",border:"3px solid #000"},children:"Move"}),Object(H.jsx)(G,{onClick:M,style:{display:"flex",alignItems:"center",justifyContent:"center",background:"#333",color:"white",border:"3px solid #000"},children:"Pass"}),Object(H.jsx)(G,{onClick:function(){return N((function(e){return"attack"===e?null:"attack"}))},style:{display:"flex",alignItems:"center",justifyContent:"center",background:"attack"===k?"#999":"#333",color:"white",border:"3px solid #000"},children:"Attack"}),["arrow","fire"].map((function(e){return Object(H.jsxs)(G,{onClick:function(){w.cooldown[e]||N((function(t){return t===e?null:e}))},style:{display:"flex",alignItems:"center",justifyContent:"center",background:b([w.cooldown[e],"#a00"],k===e?"#999":"#333"),color:"white",border:"3px solid #000"},children:[e,w.cooldown[e]&&" ("+w.cooldown[e]+")"]},e)}))]})]})]})]}),Object(H.jsx)("div",{style:{opacity:E?"1":"0.7",cursor:E?"auto":"not-allowed"},children:Object(H.jsxs)("div",{style:{display:"flex",flexDirection:"row",margin:"10px"},children:[Object(H.jsxs)("div",{style:{marginRight:"20px",minWidth:"450px"},children:[Object(H.jsx)("div",{style:{fontSize:"1.2em",background:"#345",color:"white",padding:"5px"},children:"History"}),Object(H.jsx)("div",{ref:D,style:{background:"#eee",height:"200px",overflowY:"scroll",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"},children:v.map((function(e,n){return Object(H.jsx)("div",{style:{},children:Object(H.jsx)(K,{action:e,state:t})},n)}))})]}),Object(H.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",flex:"1 100 auto",background:"#eee",minWidth:"450px"},children:[Object(H.jsx)("div",{style:{fontSize:"1.2em",background:"#345",color:"white",padding:"5px",width:"100%",boxSizing:"border-box"},children:"Possible actions"}),B.map((function(e,t){return Object(H.jsx)("div",{children:JSON.stringify(e)},t)}))]})]})})]})}function V(e){var t=e.name,n=e.avatar;return Object(H.jsxs)("div",{style:{fontWeight:"500",width:"100px",flex:"none",display:"flex",alignItems:"center",background:"#ccc",color:"black",height:"30px"},children:[Object(H.jsx)("img",{style:{width:"30px",marginRight:"5px"},src:n}),Object(H.jsx)("div",{children:t})]})}function Y(e){var t=e.effect,n=e.state,a=Object(r.useMemo)((function(){return n.chars.find((function(e){return e.id===t.charId}))}),[n]),c=Object(r.useMemo)((function(){var e=U.cloneDeep(t);return delete e.computedAt,delete e.charId,delete e.type,e}),[t]);return Object(H.jsxs)("div",{style:{margin:"2px",display:"flex",alignItems:"center",justifyContent:"flex-start"},children:[Object(H.jsx)("div",{style:{marginRight:"40px"}}),a&&Object(H.jsx)(V,{name:a.name,avatar:a.avatar}),Object(H.jsx)("div",{style:{fontWeight:"500",width:"150px",padding:"4px",height:"30px",boxSizing:"border-box",flex:"none",display:"flex",alignItems:"center",justifyContent:"flex-start",background:"#666",color:"white"},children:t.type}),Object(H.jsx)("div",{style:{fontSize:"0.8em",fontWeight:"bold",padding:"2px"},children:JSON.stringify(c)})]})}function K(e){var t=e.action,n=e.state;return t.isAction?Object(H.jsxs)("div",{style:{margin:"2px",display:"flex",alignItems:"center",justifyContent:"flex-start"},children:[Object(H.jsx)(V,{name:t.char.name,avatar:t.char.avatar}),Object(H.jsx)("div",{style:{fontWeight:"500",width:"150px",padding:"4px",height:"30px",boxSizing:"border-box",flex:"none",display:"flex",alignItems:"center",justifyContent:"flex-start",background:"#666",color:"white"},children:t.type}),b(["move"===t.type,function(){return Object(H.jsxs)("div",{style:{fontSize:"0.8em",fontWeight:"bold",padding:"2px"},children:["x:",t.x," / y:",t.y]})}],["attack"===t.type||"arrow"===t.type,function(){var e=n.chars.find((function(e){return e.id===t.target}));return Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)(V,{name:e.name,avatar:e.avatar})," ",Object(H.jsx)("div",{style:{fontSize:"0.8em",fontWeight:"bold",padding:"2px"}})]})}],["pass"===t.type,function(){return Object(H.jsx)("div",{})}])]}):Object(H.jsx)(Y,{effect:t,state:n})}function J(e){var t=e.category,n=e.value;return Object(H.jsxs)("div",{style:{display:"flex",border:"1px solid white",margin:"5px",padding:"5px",alignItems:"center",justifyContent:"flex-start"},children:[Object(H.jsx)("div",{style:{width:"100px",flex:"none",textAlign:"left"},children:t}),Object(H.jsx)("div",{style:{width:"100px",textAlign:"left"},children:n})]})}function X(e){var t=e.tileHover,n=e.charHover,a=e.state,c=Object(r.useMemo)((function(){return a.chars.find((function(e){return e.id===n}))}),[a,n]),i=Object(r.useMemo)((function(){if(t)return a.map.tiles[t.index]}),[t,a]);return Object(H.jsx)("div",{style:{flex:"none",width:"300px",background:"#345",color:"#fff",position:"absolute",bottom:"0px",right:"0px"},children:b([c,function(){return Object(H.jsxs)("div",{children:[Object(H.jsx)("div",{style:{margin:"10px"},children:Object(H.jsx)("img",{src:c.avatar,style:{width:"30px"}})}),Object(H.jsx)("div",{style:{margin:"10px"},children:c.name}),Object(H.jsx)(J,{category:"team",value:c.team}),Object(H.jsx)(J,{category:"user",value:c.user}),Object(H.jsx)(J,{category:"hp",value:c.hp}),Object(H.jsx)(J,{category:"pa",value:c.pa}),Object.keys(c.cooldown).length>0&&Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)("div",{children:"Cooldown"}),Object.keys(c.cooldown).map((function(e){return Object(H.jsx)(J,{category:e,value:c.cooldown[e]})}))]})]})}],[i,function(){return Object(H.jsxs)("div",{children:[" ",Object(H.jsx)(J,{category:"type",value:P(i)}),i.effects.length>0&&Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)("div",{children:"Effects"}),i.effects.map((function(e){return Object(H.jsxs)("div",{children:[Object(H.jsx)(J,{category:"type",value:e.type}),Object(H.jsx)(J,{category:"cooldown",value:e.cooldown})]})}))]})]})}],Object(H.jsx)("div",{children:"Hover something"}))})}function q(e){var t=e.char,n=e.charHover,a=e.currentChar,c=e.onMouseEnter,i=e.onMouseLeave,o=e.onClick,u=e.myTeam,l=Object(r.useRef)(),d=Object(r.useRef)(),f=t.team===u,p=Object(r.useRef)(t);Object(r.useEffect)((function(){p.current=t}),[t]);var x=Object(r.useCallback)((function(e){var t=e.x,n=e.y;d.current.position.x=t,d.current.position.z=n})),j=Object(r.useState)(null),y=Object(s.a)(j,2),v=y[0],O=y[1];return Object(F.d)((function(){var e=p.current;if(e.anim){var t=performance.now()-e.anim.startTime,n=Math.min(1,Math.max(0,t/500));if(e.anim.type===N.ANIM_MOVE)x({x:e.anim.from.x*(1-n)+e.anim.to.x*n,y:e.anim.from.y*(1-n)+e.anim.to.y*n});else if(e.anim.type===N.ANIM_ATTACK){var r=m(0,.5,n)*m(1,.5,n);x({x:e.x*(1-r)+(e.x+.5*e.anim.d.x)*r,y:e.y*(1-r)+(e.y+.5*e.anim.d.y)*r})}else if(e.anim.type===N.ANIM_ARROW){var a=m(0,.5,n)*m(1,.5,n);x({x:e.x*(1-a)+(e.x+.5*e.anim.d.x/e.anim.d.l)*a,y:e.y*(1-a)+(e.y+.5*e.anim.d.y/e.anim.d.l)*a})}else if(e.anim.type===N.ANIM_END_TURN){var c=-(30+10*m(0,1,n));O({y:c+"px",opacity:m(0,.4,n)*m(1,.7,n)}),1===n&&O(null)}1===n&&(e.anim=null)}else x(e)})),Object(H.jsx)(H.Fragment,{children:Object(H.jsxs)("group",{ref:d,position:[0,0,0],children:[" ",a.id===t.id&&Object(H.jsx)("spotLight",{target:l.current,castShadow:!0,position:[0,10,0],angle:.15,penumbra:1,color:"#00f"}),Object(H.jsxs)(w.a,{prepend:!0,center:!0,fullscreen:!0,distanceFactor:10,zIndexRange:[100,0],transform:!0,sprite:!0,style:{transform:"translate(0px, -50px)",position:"relative"},pointerEvents:"none",children:[v&&Object(H.jsx)("div",{style:{position:"absolute",left:"50%",top:"0px",transform:"translate(-50%,"+v.y+")",zIndex:"500"},children:Object(H.jsx)("div",{style:{background:"#fff9",display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"50%",opacity:v.opacity},children:Object(H.jsx)("img",{style:{width:"20px"},src:"/webturn/img/time.svg"})})},"endTurn"),Object(H.jsx)("div",{style:{background:"#111",borderRadius:"3px",padding:"2px 1px 2px 2px",display:"flex"},children:Object(h.a)(Array(I).keys()).map((function(e){return Object(H.jsx)("div",{style:{width:"4px",height:"4px",borderRadius:"1px",margin:"0px 1px 0px 0px",transition:"300ms",background:b([0===t.hp,"#000"],[e+1<=t.hp,"#0f0"],"#e00")}},e)}))})]}),Object(H.jsxs)("mesh",{castShadow:!0,receiveShadow:!0,position:[0,.65,0],ref:l,scale:1,onClick:o,onPointerOver:c,onPointerOut:i,children:[Object(H.jsx)("boxGeometry",{args:[.7,1.3,.7]}),Object(H.jsx)("meshStandardMaterial",{color:"orange"})]}),Object(H.jsx)(E.a,{position:[0,.01,0],args:[.5,.6,32],"rotation-x":-Math.PI/2,children:Object(H.jsx)("meshBasicMaterial",{attach:"material",color:f?"#0b0":"#f00"})}),n===t.id&&Object(H.jsx)(E.a,{position:[0,.01,0],args:[.6,.7,32],"rotation-x":-Math.PI/2,children:Object(H.jsx)("meshBasicMaterial",{attach:"material",color:"#fff"})})]})})}function Q(e){var t=e.colIndex,n=e.rowIndex,a=e.state,c=e.tile,i=e.tileHover,o=e.setTileHover,s=Object(r.useMemo)((function(){return t+n*a.map.w}),[t,n,a]),u=Object(r.useMemo)((function(){return(null===i||void 0===i?void 0:i.index)===s}),[t,n,a,i]),l=Object(r.useMemo)((function(){return void 0!==c.effects.find((function(e){return"fire"===e.type}))}));return Object(H.jsxs)(H.Fragment,{children:[b([1===c.type,function(){return Object(H.jsxs)("mesh",{onPointerEnter:function(){o({x:t,y:n,index:s})},castShadow:!0,receiveShadow:!0,position:[t,.5,n],scale:1,children:[Object(H.jsx)("boxGeometry",{args:[1,1,1]}),Object(H.jsx)("meshStandardMaterial",{color:"#555"})]})}],[0===c.type,function(){return Object(H.jsxs)("mesh",{onPointerEnter:function(){o({x:t,y:n,index:s})},castShadow:!0,receiveShadow:!0,position:[t,-.05,n],scale:1,children:[Object(H.jsx)("boxGeometry",{args:[1,.1,1]}),Object(H.jsx)("meshStandardMaterial",{color:u?"#bbb":"#999"})]})}]),l&&Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)("pointLight",{distance:1.5,intensity:4,position:[t,.3,n],color:"#fb0"}),Object(H.jsxs)("group",{position:[t,0,n],children:[" ",Object(H.jsx)(Z,{active:!0})]})]})]})}function Z(e){var t=e.active,n=Object(r.useRef)(),a=Object(r.useMemo)((function(){return new z.Object3D}),[]),c=Object(r.useMemo)((function(){var e=[];if(!t)return e;for(var n=0;n<100;n++){var r=2e3*Math.random(),a=Math.random(),c=Math.random(),i=Math.random(),o=Math.random(),s=Math.random(),u=Math.random(),l=100*Math.random()-50,d=100*Math.random()-50,f=100*Math.random()-50;e.push({startLife:0,maxLife:r,x:a,y:c,z:i,vx:o,vy:s,vz:u,xFactor:l,yFactor:d,zFactor:f})}return e}),[t]);return Object(F.d)((function(e,t){var r=performance.now();c.forEach((function(e,c,i){var o=e.startLife,s=e.maxLife,u=e.x,l=e.y,d=e.z,f=e.vx,p=e.vy,h=e.vz,x=e.xFactor,j=e.yFactor,b=e.zFactor,y=(r-o)/(s-o);y>1&&(u=Math.random()-.5,l=.2*Math.random(),d=Math.random()-.5,f=.5*(Math.random()-.5),p=Math.random(),h=.5*(Math.random()-.5),o=r,s=r+1e3+1e3*Math.random(),y=0),u+=f*t,l+=p*t,d+=h*t;var m=.15;a.position.set(u,l,d),a.scale.set(m,m,m),a.rotation.set(x,j,b),a.updateMatrix(),i[c]={startLife:o,maxLife:s,x:u,y:l,z:d,vx:f,vy:p,vz:h,xFactor:x,yFactor:j,zFactor:b},n.current.setMatrixAt(c,a.matrix)})),n.current.instanceMatrix.needsUpdate=!0})),Object(H.jsx)(H.Fragment,{children:Object(H.jsxs)("instancedMesh",{ref:n,args:[null,null,100],children:[Object(H.jsx)("dodecahedronBufferGeometry",{attach:"geometry",args:[.2,0]}),Object(H.jsx)("meshBasicMaterial",{attach:"material",color:"#fda",blending:z.AdditiveBlending,transparent:!0,opacity:.7})]})})}var $=n(35),ee=new p.a,te={w:14,h:14,tiles:"\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, \n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, \n  1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, \n  1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, \n  1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,\n  1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,\n  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, \n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1\n".replace(" ","").split(",").map((function(e){return{type:parseInt(e),effects:[]}}))},ne=null;function re(e,t){return ae.apply(this,arguments)}function ae(){return(ae=Object(u.a)(d.a.mark((function e(t,n){var r,a,c,i,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("dispatch start",n.type),"tick"!==n.type){e.next=9;break}if("me"!==t.currentChar.user){e.next=6;break}return e.abrupt("return",t);case 6:return e.next=8,ee.generateBestIAAction(t);case 8:n=e.sent;case 9:return r=$.cloneDeep(t),a=R(r,n,t.currentChar.user),c=a.cost,i=a.possible,s=a.effects,i&&(r.actions.push(Object(o.a)(Object(o.a)({computedAt:performance.now()},n),{},{char:r.currentChar,cost:c})),S(r,s,!0)),console.log("dispatch end"),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ce=function(){var e=Object(r.useRef)(function(){var e=function(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)},t=[0,e(),e(),e(),e(),e()],n={lastEffectTime:performance.now(),map:te,objects:[{id:e(),type:"barrel",name:"barrel",x:6,y:6,hp:1,onDestroyEffect:{type:"explode",damage:1,radius:2}}],chars:[{id:t[0],x:1,y:1,name:"foo",lastPlayedTurn:-1,user:"me",team:"1",pa:M,avatar:"https://avatars.dicebear.com/api/bottts/"+t[0]+".svg",hp:I,cooldown:{}},{id:t[1],x:5,y:2,name:"bar",lastPlayedTurn:-1,user:"me",team:"1",pa:M,avatar:"https://avatars.dicebear.com/api/bottts/"+t[1]+".svg",hp:I,cooldown:{}},{id:t[2],x:9,y:3,name:"baz",lastPlayedTurn:-1,user:"me",team:"1",pa:M,avatar:"https://avatars.dicebear.com/api/bottts/"+t[2]+".svg",hp:I,cooldown:{}},{id:t[3],x:11,y:11,name:"zoo",lastPlayedTurn:-1,user:"ia",team:"2",pa:M,avatar:"https://avatars.dicebear.com/api/bottts/"+t[3]+".svg",hp:I,cooldown:{}},{id:t[4],x:2,y:11,name:"moo",lastPlayedTurn:-1,user:"ia",team:"2",pa:M,avatar:"https://avatars.dicebear.com/api/bottts/"+t[4]+".svg",hp:I,cooldown:{}},{id:t[5],x:6,y:11,name:"noo",lastPlayedTurn:-1,user:"ia",team:"2",pa:M,avatar:"https://avatars.dicebear.com/api/bottts/"+t[5]+".svg",hp:I,cooldown:{}}],actions:[],effects:[]};return n.nextChars=D(n),n.currentChar=n.nextChars[0],n}()),t=Object(r.useCallback)(function(){var t=Object(u.a)(d.a.mark((function t(n){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!ne){t.next=4;break}if(console.error("alreadyReducing !!!",ne,"while starting",n),"tick"!==n.type){t.next=4;break}return t.abrupt("return");case 4:return ne=n,t.next=7,re(e.current,n);case 7:e.current=t.sent,ne=null,i(e.current);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[]),n=Object(r.useState)(e.current),a=Object(s.a)(n,2),c=a[0],i=a[1];return Object(r.useEffect)((function(){setTimeout((function(){t({type:"tick"})}),500)}),[c,t]),Object(H.jsx)("div",{className:"App",children:Object(H.jsx)(B,{user:"me",state:c,do_action:t})})},ie=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,71)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(H.jsx)(a.a.StrictMode,{children:Object(H.jsx)(ce,{})}),document.getElementById("root")),ie()}},[[62,1,2]]]);
//# sourceMappingURL=main.e386cb8f.chunk.js.map